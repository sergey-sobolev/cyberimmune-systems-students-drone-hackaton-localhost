# Отчёт о выполнении задачи "Drone Atomizer"

- [Отчёт о выполнении задачи "Drone Atomizer"](#отчёт-о-выполнении-задачи-drone-atomizer)
  - [Постановка задачи](#постановка-задачи)
  - [Известные ограничения и вводные](#известные-ограничения-и-вводные)
    - [Цели и Предположения Безопасности (ЦПБ)](#цели-и-предположения-безопасности-цпб)
      - [Цели](#цели)
      - [Предположения](#предположения)
  - [Архитектура решения](#архитектура-решения)
    - [Компоненты](#компоненты)
      - [Монитор безопасности (security monitor)](#монитор-безопасности-security-monitor)
    - [Алгоритм работы решения](#алгоритм-работы-решения)
    - [Описание cценариев (последовательности выполнения операций), при которых ЦБ нарушаются\*](#описание-cценариев-последовательности-выполнения-операций-при-которых-цб-нарушаются)
      - [Негативный сценарий 1. Некорректная авторизация](#негативный-сценарий-1-некорректная-авторизация)
      - [Негативный сценарий 2. Не соответствие хэш-сумм с УЦ](#негативный-сценарий-2-не-соответствие-хэш-сумм-с-уц)
      - [Негативный сценарий 3. Не соответствие хэш-сумм с МП](#негативный-сценарий-3-не-соответствие-хэш-сумм-с-мп)
      - [Негативный сценарий 4. Мобильное приложение отправляет дрон домой до выполнения задания](#негативный-сценарий-4-мобильное-приложение-отправляет-дрон-домой-до-выполнения-задания)
      - [Сводная таблица негативных сценариев](#сводная-таблица-негативных-сценариев)
    - [Указание "доверенных компонент" на архитектурной диаграмме с обоснованием выбора](#указание-доверенных-компонент-на-архитектурной-диаграмме-с-обоснованием-выбора)
    - [Политики безопасности](#политики-безопасности)
    - [Запуск приложения](#запуск-приложения)


## Постановка задачи
Реализовать ПО дрона,мобильного приложения и управляющего центра. Разрабатываемое ПО должно считаться безопасным

## Известные ограничения и вводные

По условиям организаторов должна использоваться микросервисная архитектура и шина обмена сообщениями для реализации асинхронной работы сервисов.

### Цели и Предположения Безопасности (ЦПБ)

#### Цели

1. дрон должен выполнять только авторизованные команды
2. получение задания только от доверенного сервера
3. в случае многократных попыток неавторизованного доступа вернуться на базу
4. аутентификация компонентов - каждый модуль может работать только с теми модулями, которые прописаны в политике безопасности
5. делать снимок местности до и после распыления
6. логирование(в разработке)
7. внедрение шифрования внедрение внутреннего шифрования - против прослушки, перехвата и изменения пакетов, пересылаемых дрону(в разработке)
8.  блокировка распылителя при аварийном или принудительном возвращении домой

#### Предположения

1. не рассматриваются вопросы физической безопасности устройства
2. защита от намеренного искажения GPS-координат
3. сервис "Монитор безопасности" (SM) является полностью доверенным

## Архитектура решения
### Компоненты

| Название | Модули | Назначение | 
|----|----|----|
|*Drone* |управление полетом,GPS позиционирование,инерциальная навигация,управление распрыскивателем,контроль состояния полета,контроль обстановки| ПО дрона | 
|*MobileApp* |связь с МП| ПО для МП |
|*Control_center_connection* |связь с УЦ | центр управления дроном | 
|*Security monitor*<br>(монитор безопасности) |политика безопасности| разрешает действие,если оно удовлетворяет политике безопасности |
|*Message monitor* |  | инструмент для взаимодействия модулей|

Более подробное описание о функциях компонентов, логике их работы и методах взаимодействия см. ниже


#### Монитор безопасности (security monitor)



### Алгоритм работы решения

![Алгоритм работы решения](hackaton/../out/full_alg/full_alg.png)

### Описание cценариев (последовательности выполнения операций), при которых ЦБ нарушаются*

1.  Неавторизованная команда
    1.  Включение дрона
    2.  Инициализация управления полетом
    3.  Отправка отчета о состоянии дрона в МП(дрон исправлен)
    4.  Передача неизвестной команды

2.  Запрос не от корпоративного сервера
    1.  Послать запрос не от корпоративного сервера

3.  Многократная попытка управления дроном не от авторизованного пользователя
    1.  Включение дрона
    2.  Инициализация управления полетом
    3.  Отправка отчета о состоянии дрона в МП(дрон исправлен)
    4.  Передача команды на запуск дрона
    5.  Передача полетного задания
    6.  Передача полетного задания в МП
    7.  Получение сообщения о начале полета
    8.  Послать более х(количество запросо) запросов на дрон(Дрон возвращается на базу)

4.  Аутентификация компонентов
    1.  Создать компонент(кодом)
    2.  Присвоить ему имя идентификации
    3.  Послать обращение к другому ?контейнеру?

5.  Подключение нескольких устройств к 1 дрону
6.  Негативный кейс с возвратом домой


#### Негативный сценарий 1. Некорректная авторизация

![Некорректная авторизация](hackaton/../out/algo1/algo1.png)

#### Негативный сценарий 2. Не соответствие хэш-сумм с УЦ

![Не соответствие хэш-сумм с УЦ](hackaton/../out/algo2/algo2.png)

#### Негативный сценарий 3. Не соответствие хэш-сумм с МП

![](hackaton/../out/algo3/algo3.png)

#### Негативный сценарий 4. Мобильное приложение отправляет дрон домой до выполнения задания


![Мобильное приложение отправляет дрон домой до выполнения задания](hackcaton/../out/algo4/algo4.png)

#### Сводная таблица негативных сценариев

|?  | Название | Скомпрометированная часть системы | Нарушенная цель безопасности |
|----|----|----|----|
|1 | Некорректная авторизация | Связь с МП | 1 |
|2 | Не соответствие хэш-сумм с УЦ | Связь с УЦ | 2 |
|3 | Не соответствие хэш-сумм с МП  | Связь с МП | 2 |
|4 | Мобильное приложение отправляет дрон домой до выполнения задания  | Связь с МП | 8 |

### Указание "доверенных компонент" на архитектурной диаграмме с обоснованием выбора

![](hackaton/../out/approved/approved.png)

### Политики безопасности


```python {lineNo:true}

def check_operation(id, details):
    global ordering
    authorized = False
    # print(f"[debug] checking policies for event {id}, details: {details}")
    print(f"[info] checking policies for event {id},"\
          f" {details['source']}->{details['deliver_to']}: {details['operation']}")
    src = details['source']
    dst = details['deliver_to']
    operation = details['operation']
    
    if src == 'drone_status' and dst == 'mobile_connection' \
        and operation == 'info':
        authorized = True  
    if src == 'mobile_connection' and dst == 'drone_status' \
        and operation == 'drone_start':
        authorized = True   
    if src == 'drone_status' and dst == 'control_center' \
        and operation == 'task_add':
        authorized = True   
    if src == 'control_center' and dst == 'drone_status' \
        and operation == 'task_response':
        authorized = True   
              
    if src == 'control_center' and dst == 'mobile_connection' \
        and operation == 'task_info':
        authorized = True   
    if src == 'drone_status' and dst == 'mobile_connection' \
        and operation == 'job_error':
        authorized = True  
    if src == 'drone_status' and dst == 'control_center' \
        and operation == 'job_error':
        authorized = True 
    if src == 'mobile_connection' and dst == 'drone_status' \
        and operation == 'status_request':
        authorized = True   
    if src == 'drone_status' and dst == 'mobile_connection' \
        and operation == 'status_response':
        authorized = True   
    if src == 'mobile_connection' and dst == 'drone_status' \
        and operation == 'drone_to_home':
        authorized = True 
    if src == 'drone_status' and dst == 'control_center' \
        and operation == 'task_completed':
        authorized = True 

    if src == 'drone_status' and dst == 'sprayer_control' \
        and operation == 'on_sprayer':
        authorized = True 
    if src == 'sprayer_control' and dst == 'flying_control' \
        and operation == 'sprayer_condition':
        authorized = True 
    if src == 'drone_status' and dst == 'situation_control' \
        and operation == 'check_earth':
        authorized = True 
    if src == 'drone_status' and dst == 'control_center' \
        and operation == 'task_completed':
        authorized = True 

    return authorized
```

### Запуск приложения

см. [инструкцию по запуску](../../README.md)


